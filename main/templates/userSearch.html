{%extends "base.html"%}

{%block head%}
    <title>User Search</title>

    <script type="text/javascript">
        $(document).ready(function(){                         
            axios.defaults.xsrfHeaderName = "X-CSRFTOKEN";
            axios.defaults.xsrfCookieName = "csrftoken";

            var app = new Vue({
                elimiters: ['[[', ']]'],
                el: '#root',        
                data:{
                    baseURL:'{{request.get_full_path}}',                                                                                                                 
                    users:[],      
                    searchInfo:"", 
                    warningText:""                                           ,
                },

                methods:{
                    getUsers: function(){
                        axios.post('{{request.get_full_path}}', {                            
                            action:"getUsers",
                            searchInfo:app.$data.searchInfo,                                
                        })
                        .then(function (response) {
                           app.$data.users=JSON.parse(response.data.users);
                           
                           if(app.$data.users.length == 0)
                           {
                              app.$data.warningText="No users found."
                           }
                           else
                           {
                              app.$data.warningText="";
                           }

                        })
                        .catch(function (error) {
                            console.log(error);                               
                        }); 
                    },                                        

                    formatDate: function(value){
                            if (value) {
                                //return value;
                                return moment(String(value)).local().format('M/D/YYYY, h:mm a')
                            }
                            else{
                                return "date format error";
                            }
                        },           
                  
                },
                
                mounted: function(){
                    
                },
            });
        });
    </script>
{%endblock head%}

{%block content%}
<div class="row justify-content-lg-center">
    <div class="col col-lg-10">
        <div class="card">                  
            <div class="card-header">
                Search Users                                                       
            </div>
            <div class="card-body">
                
                <div class="row">
                    <div class="col col-lg-6 offset-lg-3">
                        <center>
                            <div class="input-group mb-3">
                                <input  v-on:keyup.enter="getUsers()" v-model="searchInfo" type="text" class="form-control" placeholder="User Info" aria-label="User Info" aria-describedby="basic-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-primary" type="button" v-on:click = "getUsers()">Search</button>
                                </div>
                            </div>
                        </center>
                    </div>                   
                </div>
               
                <center><span v-html="warningText" style="color:red;"></span></center>              
                
                <table class="table table-hover table-condensed">                            

                    <caption style="caption-side:top;text-align: center;">Users</caption>

                    <thead>
                        <th width="35%">
                            Name
                        </th> 
                        <th width="30%" style="text-align: center;">
                            Info
                        </th>                                                      
                        <th width="35%" style="text-align: center;">
                            Control
                        </th>
                    </thead>

                    <tbody id="userList">                                                  
                        <tr v-for="(u,index) in users" v-bind:key="u.id">                                                                          
                            <td> 
                                <a :href="'/userInfo/' + u.id + '/' "><span v-html="u.last_name + ', ' + u.first_name"></span></a>                                        
                            </td>
                            <td style="text-align: center;">                                        
                                <span v-html="u.email + '<br>ID: ' + u.profile__chapmanID + '<br>' + u.profile__type__name.toUpperCase()">                                         
                            </td>                               
                            <td>
                            </td>                            
                        </tr>                                                    
                    </tbody>
                    
                </table>                     

                
            </div>                    
        </div>                
    </div>
</div>    
{%endblock content%}