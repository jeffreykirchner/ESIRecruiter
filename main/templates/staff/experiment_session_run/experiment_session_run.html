<div class="card">                  
    <div class="card-header">
      Run Session Day : <a href="{% url 'experimentView' sessionDay.experiment_session.experiment.id %}">{{sessionDay.experiment_session.experiment}}</a> | 
                        <a href="{% url 'experimentSessionView' sessionDay.experiment_session.id %}">Session Info</a> |
                        <span v-html="dateText"></span>
    </div>
    <div class="card-body">  
        <!-- stripe reader -->
        <div v-show="sessionDay.complete === false">
            <div class="row align-items-left">
                <div class = "col-md-4" style="text-align: right;">
                    
                    <div class="form-check" v-if='isAdmin'>
                        <input type="checkbox" class="form-check-input" id="autoAdd" v-model='autoAddUsers'>
                        <label class="form-check-label" for="autoAdd" title="Add user to session after card swipe.">Automatically add subjects</label>
                    </div>
                    <div class="form-check" v-if='isAdmin'>
                        <input type="checkbox" class="form-check-input" id="ignoreConstraints" v-model='ignoreConstraints'>
                        <label class="form-check-label" for="ignoreConstraints" title="Force-add user to session even if not eligible.">Ignore recruitment constraints</label>
                    </div>
                    
                </div>
                <div class = "col-md-4">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                        <span class="input-group-text">Stripe Reader</span>
                        </div>
                        <input type="password" autocomplete="off" placeholder="Cursor Here" class="form-control" aria-label="Stripe Reader" v-model="stripeReaderValue" title="Put the mouse cursor here and swipe the subject's id card to check-in.">
                        <div class="input-group-append">
                        <span class="input-group-text"><span v-html="stripeReaderSpinner"></span></span>
                        </div>
                    </div>
                </div>
                <div class = "col" style="text-align: left;padding-top: 10px;">
                    <span v-html="stripeReaderStatus"></span>
                </div>                    
            </div>  
        </div>      

        <!-- subject table     -->
        <div class="row">
            <div class = "col">
                <table class="table table-hover table-condensed table-responsive-xl">
                    <caption style="caption-side: top;" class="caption text-center">Subjects Confirmed: [[sessionDay.confirmedCount]] | 
                                                                                    Attending: [[sessionDay.attendingCount]] | 
                                                                                    Needed: [[sessionDay.requiredCount]] | 
                                                                                    Bumped: [[sessionDay.bumpCount]]
                    </caption>
                    <thead>
                        <th scope="col" width="25%">
                            Name 
                        </th>
                        <th scope="col" width="15%">
                            ID Number 
                        </th>
                        <th scope="col" width=15%  style="text-align: center;">  
                            Earnings ($)
                        </th> 
                        <th scope="col" width=15%  style="text-align: center;">  
                            On-Time<br>Bonus ($)
                        </th>   
                        <th scope="col" width=15%  style="text-align: center;">  
                            Status
                        </th>                                                                             
                        <th scope="col" width="15%" style="text-align: center;">
                            Control
                        </th>
                    </thead>
                    <tbody>
                        <tr v-for="(esdu,index) in sessionDay.experiment_session_days_user" v-bind:key="esdu.id">
                                                       
                            <td class="align-middle m-1 p-1">
                                <span v-html="index+1"></span>) 
                                <a  v-bind:href='"/userInfo/" + esdu.user.id' target="_blank">
                                    <span v-html="esdu.user.last_name"></span>, <span v-html="esdu.user.first_name"></span>
                                </a>                                    
                            </td>
                            <td  class="align-middle m-1 p-1">                                       
                                <span v-html="esdu.user.studentID"></span>                                    
                            </td> 
                            <td class="align-middle m-1 p-1 text-center">
                                <div v-if='esdu.attended'>
                                    <div v-if='sessionDay.complete'>
                                        $<span v-html="esdu.earnings"></span>
                                    </div>
                                    <div v-else>
                                        <input type="number" step="0.01" class="form-control" style="text-align: center;" v-model="esdu.earnings"
                                            v-on:change="payoutsChange(esdu.id,index)" v-on:keyup= "payoutsKeyUp(esdu.id,index)" title="Enter experiment earnings here.">
                                    </div>
                                </div>                                                                                                                  
                            </td>                                    
                            <td class="align-middle m-1 p-1 text-center">
                                <div v-if='esdu.attended || esdu.bumped'>
                                    <div v-if='sessionDay.complete'>
                                        $<span v-html="esdu.show_up_fee"></span>
                                    </div>
                                    <div v-else>
                                        <input type="number" step="0.01" class="form-control" style="text-align: center;" v-model="esdu.show_up_fee"
                                           v-on:change="payoutsChange(esdu.id,index)" v-on:keyup= "payoutsKeyUp(esdu.id,index)" title="Enter on-time bonus here.">
                                    </div>                                           
                                </div>                                        
                            </td>
                            <td class="align-middle m-1 p-1 text-center">                                       
                                <div v-if="esdu.attended">Attended</div>
                                <div v-else-if="esdu.bumped">Bumped</div>
                                <div v-else-if="sessionDay.canceled">Canceled</div>
                                <div v-else>No Show</div>                                                                           
                            </td>
                            <td class="align-middle m-1 p-1 text-center">
                                <div v-show="sessionDay.complete === false">  
                                    <div v-if = "esdu.waiting">
                                        <span v-html='waitButtonText'></span>
                                    </div>
                                    <div v-else-if="esdu.attended">
                                        <button v-bind:id="'bumpSubject' + esdu.id" type="button" class="btn btn-outline-primary btn-sm"
                                                v-on:click = "bumpSubject(esdu.id,index)" title="Change subject's status to 'Bumped'.">
                                            <span v-html='bumpButtonText'></span>
                                        </button>
                                        <div v-if='esdu.user.bumpedFromLast' v-html='"(Bumped last session)"' style="font-size: 14px;"></div> 
                                    </div>
                                    <div v-else-if="esdu.bumped">
                                        <button v-bind:id="'nowSubject' + esdu.id" type="button" class="btn btn-outline-primary btn-sm"
                                                v-on:click = "noShowSubject(esdu.id,index)" title="Change subject's status to 'No Show'.">
                                            <span v-html='noShowButtonText'></span>
                                        </button>
                                        <div v-if='esdu.user.bumpedFromLast' v-html='"(Bumped last session)"' style="font-size: 14px;"></div>
                                    </div>
                                    <div v-else-if="isAdmin">
                                        <button v-bind:id="'attendSubject' + esdu.id" type="button" class="btn btn-outline-primary btn-sm"
                                                v-on:click = "attendSubject(esdu.id,index)" title="Change subject's status to 'Attended'.">
                                            <span v-html='attendButtonText'></span>
                                        </button>
                                    </div>
                                </div>                                                                               
                            </td>                                
                        </tr>
                    </tbody>                                                                      
                    <tfoot>
                        <!-- first button row -->
                        <tr>
                            <td>
                                Payout Total: $[[payoutTotal]]                                      
                            </td>
                            <td>                                        
                                <button v-show="sessionDay.complete === false" type="button" class="btn btn-outline-primary btn-sm" v-on:click = "savePayouts()"
                                        title="Save payouts to the database.">
                                    <span v-html='saveButtonText'></span> 
                                </button>                                                                                
                            </td>
                            <td style="text-align: center;">                                        
                                <div v-show="sessionDay.complete === false" class="input-group input-group-sm">
                                    <input type="number" class="form-control" placeholder="All Earnings" aria-label="Earnings fill"
                                            aria-describedby="basic-addon2" v-model="fillEarningsWithValue" title="Fill all attending subject's earnings with the specified amount.">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-primary btn-sm" type="button" v-on:click = "fillEarningsWithFixed()">
                                            <span v-html="fillEarningsWithFixedButtonText"></span>
                                        </button>
                                    </div>
                                </div>                                                                                                                    
                            </td>
                            <td style="text-align: center;">                                        
                                <button v-show="sessionDay.complete === false" type="button" class="btn btn-outline-primary btn-sm" v-on:click = "fillWithDefaultShowUpFee()"
                                        title="Fill all present subject's on-time bonuses with the specified amount." >
                                    <span v-html='fillShowUpFeeButtonText'></span> 
                                </button>                                                                                                                        
                            </td>
                            <td style="text-align: center;">                                        
                                <button v-show="sessionDay.complete === false" type="button" class="btn btn-outline-primary btn-sm" v-on:click = "autobump()"
                                        title = "Randomly bump extra subjects.">
                                    <span v-html='autoBumpButtonText'></span> 
                                </button>                                        
                            </td>
                            <td style="text-align: center;">        
                                <button v-show="sessionDay.complete === false" type="button" class="btn btn-outline-primary btn-sm" v-on:click = "bumpAll()"
                                        title = "Bump all subjects.">
                                    <span v-html='bumpAllButtonText'></span> 
                                </button>
                            </td>
                        </tr>
                        
                        <!-- second button row -->
                        <tr>
                            <td> 

                                <button type="button" class="btn btn-outline-primary btn-sm" v-on:click = "completeSession()" v-bind:disabled = "sessionDay.reopenAllowed === false">
                                    <div v-if="sessionDay.complete">
                                        <span v-html='openSessionButtonText'></span>
                                    </div>
                                    <div v-else>
                                        <span v-html='completeSessionButtonText'></span>
                                    </div>                                            
                                </button>                                     
                            </td>
                            <td>     
                                <button v-show="sessionDay.complete === false" type="button" class="btn btn-outline-primary btn-sm" v-on:click="showUploadEarnings()"
                                        title ="Upload an earnings formatted file.">
                                    Upload Earnings <i class="fas fa-upload"></i>
                                </button>
                            </td>
                            <td style="text-align: center;">                                        
                                <button type="button" class="btn btn-link btn-sm" v-on:click="printPayouts()">
                                    <span v-html='printPayoutsButtonText'></span> 
                                </button>                                                                               
                            </td>
                            <td style="text-align: center;">
                                <button type="button" class="btn btn-link btn-sm" v-on:click = "printBumps()">
                                    <span v-html='printBumpsButtonText'></span> 
                                </button>                                        
                            </td>
                            <td style="text-align: center;">
                                <button v-show="sessionDay.complete === false" type="button" class="btn btn-outline-primary btn-sm" v-on:click = "roundEarningsUp()"
                                        title="Round earnings up to nearest 25 cents."  >
                                    <span v-html='roundUpButtonText'></span> 
                                </button>                                       
                            </td>
                            <td style="text-align: center;">   
                                <button type="button" class="btn btn-outline-primary btn-sm" v-on:click = "payPalExport()"
                                        title="Export a PayPal mass payment file."  >
                                    <span v-html='paypalExportButtonText'></span> 
                                </button>                                     
                            </td>
                        </tr>                               
                        
                        <!-- third button row -->
                        <tr>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td style="text-align: center;">
                            </td>
                            <td style="text-align: center;">
                            </td>
                            <td style="text-align: center;">
                                <button type="button" class="btn btn-outline-primary btn-sm" v-on:click = "earningsExport()"
                                        title="Export a CSV file with a list of attending subjects."  >
                                    <span v-html='earningsExportButtonText'></span> 
                                </button>
                            </td>
                            <td style="text-align: center;">
                                <button v-show="sessionDay.complete === false && isAdmin" type="button" class="btn btn-outline-primary btn-sm" v-on:click = "payPalAPI()"
                                        title="Pay subjects directly using PayPal's API" v-bind:disabled = "sessionDay.paypalAPI">
                                    <span v-html='paypalDirectButtonText'></span> 
                                </button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>    
    </div>
</div>