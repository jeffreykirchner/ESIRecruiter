{%extends "base.html"%}
{% load crispy_forms_tags %}
{% load humanize %}
{% load tz %}

{%block head%}
<title>User Info</title>

<script type="text/javascript">
    $(document).ready(function(){

        axios.defaults.xsrfHeaderName = "X-CSRFTOKEN";
        axios.defaults.xsrfCookieName = "csrftoken";

        var app = new Vue({
        
            delimiters: ["[[", "]]"],
            el: '#root',        
            data:{
                sessions:[{id:"0"}],
            },

            methods:{
                getSessions:function(){
                    axios.post('/userInfo/{{id}}/', {
                            status :"getSessions" ,                                                                                                                             
                        })
                        .then(function (response) {     
                            app.$data.sessions = response.data.sessions;       

                            for(var i=0;i<app.$data.sessions.length;i++)
                            {
                                app.$data.sessions[i].date = app.formatDate(app.$data.sessions[i].date);
                                app.$data.sessions[i].earnings = parseFloat(app.$data.sessions[i].earnings).toFixed(2);
                                app.$data.sessions[i].show_up_fee = parseFloat(app.$data.sessions[i].show_up_fee).toFixed(2);
                            }                                
                        })
                        .catch(function (error) {
                            console.log(error);
                            app.$data.searching=false;
                        });                        
                    },

                formatDate: function(value){
                        if (value) {        
                            console.log(value);                    
                            return moment(String(value)).local().format('M/D/YYYY, h:mm a');
                        }
                        else{
                            return "date format error";
                        }
                    },    
            },

            mounted: function(){
                    this.getSessions();                    
            },
        });

        
    });
</script>
{%endblock head%}

{%block content%}
<div class="row justify-content-lg-center">
    <div class="col col-lg-10">
        <div class="card">                  
            <div class="card-header">
                Subject Information: {{u.last_name}}, {{u.first_name}}     
                {%if user.is_superuser%}
                <span class="float-right">
                    <a href="/admin/main/profile/{{u.profile.id}}/change">
                        Edit
                    </a>
                </span>
                {%endif%}                                                 
            </div>
            <div class="card-body">               
             
                <form id="userForm">                                            
                    <div class = "row">
                        <div class = "col"> 
                            <span class="float-right">Email:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{{u.email}}</span>
                        </div>
                        <div class = "col"> 
                            <span class="float-right">Email Confirmed:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{%if u.profile.emailConfirmed == "yes"%}Yes{%else%}<span style="color: red;"></span>No</span>{%endif%}</span>
                        </div>                
                    </div>
                    <div class = "row">
                        <div class = "col"> 
                            <span class="float-right">Major:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{{u.profile.major}}</span>
                        </div>
                        <div class = "col"> 
                            <span class="float-right">Gender:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{{u.profile.gender}}</span>
                        </div>               
                    </div>
                    <div class = "row">
                        <div class = "col"> 
                            <span class="float-right">Enrollment Status:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{{u.profile.subjectType}}</span>
                        </div>
                        <div class = "col"> 
                            <span class="float-right">Student Worker:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{%if u.profile.studentWorker%}Yes{%else%}No{%endif%}</span>
                        </div>               
                    </div>
                    <div class = "row">
                        <div class = "col"> 
                            <span class="float-right">Phone:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{{u.profile.phone}}</span>
                        </div>
                        <div class = "col"> 
                            <span class="float-right">Blackballed:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{%if u.profile.blackballed%}<span style="color: red;">Yes</span>{%else%}No{%endif%}</span>
                        </div>               
                    </div>
                    <div class = "row">
                        <div class = "col"> 
                            <span class="float-right">Chapman ID:</span>                            
                        </div>
                        <div class = "col"> 
                            <span class="float-left">{{u.profile.chapmanID}}</span>
                        </div>
                        <div class = "col"> 
                                                        
                        </div>
                        <div class = "col"> 
                            
                        </div>               
                    </div>
                </form>
                <br>

                <table class="table table-hover table-condensed">
                    <caption style="caption-side:top;text-align: center;">Experiments Attended</caption>

                    <thead>
                        <th width="35%">
                            Experiment
                        </th> 
                        <th width="30%" style="text-align: center;">
                            Date
                        </th>                                                      
                        <th width="35%" style="text-align: center;">
                            Earnings<br>
                            Show Up | Experiment
                        </th>
                    </thead>
                    <tbody>
                        <tr v-for="(s,index) in sessions" v-bind:key="s.id">
                            <td>                                
                                <a v-bind:href='"/experimentSession/" + s.session_id'>[[s.title]]</span></a>
                            </td>
                            <td  style="text-align: center;">                                                                
                                [[s.date]]                                    
                            </td>
                            <td  style="text-align: center;">     
                                <div v-if="s.bumped">
                                    $[[s.show_up_fee]] | Bumped
                                </div>
                                <div v-else>
                                    $[[s.show_up_fee]] | $[[s.earnings]]
                                </div>                             
                            </td>
                        </tr>
                    </tbody>
                    
                

                </table>
                
            </div>                    
        </div>                
    </div>
</div>    
{%endblock content%}